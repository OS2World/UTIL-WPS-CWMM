
/*
 * (C) Chris Wohlgemuth 2002-2004
 *
 */
/*
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2, or (at your option)
 * any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; see the file COPYING.  If not, write to
 * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
 */
/*
 * If you need another license for your project/product contact me at
 * 
 * http://www.os2world.com/cdwriting
 * http://www.geocities.com/SiliconValley/Sector/5785/
 */

/*
 *  This file was generated by the SOM Compiler and Emitter Framework.
 *  Generated using: 
 *      SOM Emitter emitctm: 2.42
 */

#ifndef SOM_Module_cwcdtrack_Source
#define SOM_Module_cwcdtrack_Source
#endif
#define CWCDTrack_Class_Source
#define M_CWCDTrack_Class_Source

#define INCL_PM
#define INCL_DOS
#define INCL_DOSERRORS

#include "os2.h"
#include <stdio.h>
#include "cwaudio.h"
#include "cwcdtrack.ih"
#include "cwaudioinc.h"

#define IDINFO_TRACKNUM  100
#define SETUP_CDTRKTRACKNUM "CWCDTTRACKNUM"
#define CDTRACK_HELP_PANEL   30

PSZ _queryMp3HelpLibraryName(void);
HMODULE queryModuleHandle(void);
HMODULE queryResModuleHandle(void);
BOOL getMessage(char* text,ULONG ulID, LONG lSizeText, HMODULE hResource,HWND hwnd);

SOM_Scope BOOL  SOMLINK cwcdtrackM_wpclsCreateDefaultTemplates(M_MMCDTrack *somSelf, 
                                                               WPObject* Folder)
{
    /* M_MMCDTrackData *somThis = M_MMCDTrackGetData(somSelf); */
    M_MMCDTrackMethodDebug("M_MMCDTrack","cwcdtrackM_wpclsCreateDefaultTemplates");

    /* We don't need a template */
    return TRUE;

    /*    return (M_MMCDTrack_parent_M_MMAudio_wpclsCreateDefaultTemplates(somSelf, 
                                                                     Folder));*/
}


/*
 * The prototype for cwcdtrack_wpQueryFileSize was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_wpQueryFileSize(MMCDTrack *somSelf)
{

  /*    MMAudioData *somThis = MMAudioGetData(somSelf);*/
    /*    CWCDTrackData *somThis = CWCDTrackGetData(somSelf);*/
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpQueryFileSize");

    return (_cwmmQueryTrackInfo(somSelf, NULLHANDLE, 0, IDINFO_PLAYTIME)*44100*4);
    //    return (_ulPlaySecs*44100*4);
}

/*
 * The prototype for cwcdtrack_wpSetupOnce was replaced by the following prototype:
 */
SOM_Scope BOOL  SOMLINK cwcdtrack_wpSetupOnce(MMCDTrack *somSelf, 
                                              PSZ pszSetupString)
{
  BOOL rc;
  char buffer[CCHMAXPATH];
  ULONG bufferSize;

    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpSetupOnce");


#if 0
    _ulPlaySecs=0;
    sprintf(_chrPlayTime, "%02d:%02d",_ulPlaySecs/60, _ulPlaySecs%60);
#endif

    _cwmmSetTrackInfo(somSelf, NULLHANDLE, 16, IDINFO_BPS);
    _cwmmSetTrackInfo(somSelf, NULLHANDLE, 2, IDINFO_CHANNELS);
    _cwmmSetTrackInfo(somSelf, NULLHANDLE, 44100, IDINFO_SAMPLERATE);

    bufferSize=sizeof(buffer); 
    if(_wpScanSetupString(somSelf, pszSetupString, SETUP_CDTRKTRACKNUM, buffer, &bufferSize))
      {
        ULONG ulTrack=atoi(buffer);
        MMCDTrackData *somThis = MMCDTrackGetData(somSelf);
        if(ulTrack>0 && ulTrack<100) {
          _ulTrackNum=ulTrack;
          _wpCnrRefreshDetails(somSelf);
        }
      }
    rc=(MMCDTrack_parent_MMAudio_wpSetupOnce(somSelf, pszSetupString));
    //    _wpCnrRefreshDetails(somSelf);
    _wpSetup(somSelf, "DEFAULTVIEW=SETTINGS");

    return rc;
}

/*
 * SOM_Scope BOOL  SOMLINK cwcdtrack_wpSetup(CWCDTrack *somSelf, 
 *                                           PSZ pszSetupString)
 */
SOM_Scope BOOL  SOMLINK cwcdtrack_wpSetup(MMCDTrack *somSelf, 
                                          PSZ pszSetupString)
{
BOOL rc;
/*CWCDTrackData *somThis = CWCDTrackGetData(somSelf);*/
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpSetup");

   rc=(MMCDTrack_parent_MMAudio_wpSetup(somSelf, pszSetupString));

   return rc;
}

/*
 * The prototype for cwcdtrack_wpAddFileMenuPage was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_wpAddFileMenuPage(MMCDTrack *somSelf, 
                                                     HWND hwndNotebook)
{
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpAddFileMenuPage");

    return SETTINGS_PAGE_REMOVED;
}

/*
 * The prototype for cwcdtrack_wpAddFile1Page was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_wpAddFile1Page(MMCDTrack *somSelf, 
                                                  HWND hwndNotebook)
{
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpAddFile1Page");

    return SETTINGS_PAGE_REMOVED;
}

/*
 * The prototype for cwcdtrack_wpAddFile2Page was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_wpAddFile2Page(MMCDTrack *somSelf, 
                                                  HWND hwndNotebook)
{
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpAddFile2Page");

    return SETTINGS_PAGE_REMOVED;
}

/*
 * The prototype for cwcdtrack_wpAddFile3Page was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_wpAddFile3Page(MMCDTrack *somSelf, 
                                                  HWND hwndNotebook)
{
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpAddFile3Page");

    return SETTINGS_PAGE_REMOVED;
}

/*
 * The prototype for cwcdtrack_wpAddFileTypePage was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_wpAddFileTypePage(MMCDTrack *somSelf, 
                                                     HWND hwndNotebook)
{
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpAddFileTypePage");

    return SETTINGS_PAGE_REMOVED;
}

/*
 * The prototype for cwcdtrack_wpFilterPopupMenu was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_wpFilterPopupMenu(MMCDTrack *somSelf, 
                                                     ULONG ulFlags, 
                                                     HWND hwndCnr, 
                                                     BOOL fMultiSelect)
{

  /*    MMCDTrackData *somThis = MMCDTrackGetData(somSelf);*/
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpFilterPopupMenu");

    return CTXT_SETTINGS | CTXT_HELP;

    /* We don't want to have XFolder or WPS-Wizard menus here. These are useless
       for tracks. */
#if 0
    rc=(MMCDTrack_parent_MMAudio_wpFilterPopupMenu(somSelf, 
                                                   ulFlags, 
                                                   hwndCnr, 
                                                   fMultiSelect));

    return (CTXT_SETTINGS | rc) & ~( CTXT_OPEN|CTXT_DELETE|CTXT_ARRANGE|CTXT_NEW|CTXT_PICKUP);
#endif
}


/*
 * The prototype for cwcdtrack_wpModifyPopupMenu was replaced by the following prototype:
 */
SOM_Scope BOOL  SOMLINK cwcdtrack_wpModifyPopupMenu(MMCDTrack *somSelf, 
                                                    HWND hwndMenu, 
                                                    HWND hwndCnr, 
                                                    ULONG iPosition)
{
  /*    MMCDTrackData *somThis = MMCDTrackGetData(somSelf);*/
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpModifyPopupMenu");

    return TRUE;
    /* We don't want to have XFolder or WPS-Wizard menus here. These are useless
       for tracks. */
#if 0
    rc= (MMCDTrack_parent_MMAudio_wpModifyPopupMenu(somSelf, 
                                                    hwndMenu, 
                                                    hwndCnr, 
                                                    iPosition));
    /*    WinSendMsg(hwndMenu, MM_REMOVEITEM, MPFROM2SHORT(0xBC0D, TRUE), 0);*/
    return rc;
#endif
}

/*
 * The prototype for cwcdtrack_wpInsertPopupMenuItems was replaced by the following prototype:
 */
SOM_Scope BOOL  SOMLINK cwcdtrack_wpInsertPopupMenuItems(MMCDTrack *somSelf, 
                                                         HWND hwndMenu, 
                                                         ULONG iPosition, 
                                                         HMODULE hmod, 
                                                         ULONG MenuID, 
                                                         ULONG SubMenuID)
{
  /*    MMCDTrackData *somThis = MMCDTrackGetData(somSelf);*/
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_wpInsertPopupMenuItems");

    return (MMCDTrack_parent_MMAudio_wpInsertPopupMenuItems(somSelf, 
                                                            hwndMenu, 
                                                            iPosition, 
                                                            hmod, 
                                                            MenuID, 
                                                            SubMenuID));
}

/*
 * The prototype for cwcdtrack_cwmmQueryTrackInfo was replaced by the following prototype:
 */

/*
 * SOM_Scope ULONG  SOMLINK cwcdtrack_cwmmQueryTrackInfo(MMCDTrack *somSelf, 
 *                                                       char** chrString, 
 *                                                       ULONG ulSize, 
 *                                                       int iWhich)
 */

/*
 * The prototype for cwcdtrack_cwmmQueryTrackInfo was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrack_cwmmQueryTrackInfo(MMCDTrack *somSelf, 
                                                      PSZ chrString, 
                                                      ULONG ulSize, 
                                                      int iWhich)
{
    MMCDTrackData *somThis = MMCDTrackGetData(somSelf);
    MMCDTrackMethodDebug("MMCDTrack","cwcdtrack_cwmmQueryTrackInfo");

    switch(iWhich)
      {
      case IDINFO_TRACKNUM:
        {
        return _ulTrackNum;
        }
      default:
      break;
      }
    return (MMCDTrack_parent_MMAudio_cwmmQueryTrackInfo(somSelf, 
                                                        chrString, 
                                                        ulSize, 
                                                        iWhich));
}

/*
 * The prototype for cwcdtrackM_wpclsQueryStyle was replaced by the following prototype:
 */
SOM_Scope ULONG  SOMLINK cwcdtrackM_wpclsQueryStyle(M_MMCDTrack *somSelf)
{
    /* M_CWCDTrackData *somThis = M_CWCDTrackGetData(somSelf); */
    M_MMCDTrackMethodDebug("M_MMCDTrack","cwcdtrackM_wpclsQueryStyle");

    return (M_MMCDTrack_parent_M_MMAudio_wpclsQueryStyle(somSelf)
            |CLSSTYLE_NEVERLINK|CLSSTYLE_NEVERCOPY|CLSSTYLE_NEVERMOVE|CLSSTYLE_NEVERPRINT|CLSSTYLE_DONTTEMPLATE);
}

/*
 * The prototype for cwcdtrackM_wpclsQueryTitle was replaced by the following prototype:
 */
SOM_Scope PSZ  SOMLINK cwcdtrackM_wpclsQueryTitle(M_MMCDTrack *somSelf)
{
  static char chrTitle[20]={0};

    /* M_CWCDTrackData *somThis = M_CWCDTrackGetData(somSelf); */
    M_MMCDTrackMethodDebug("M_MMCDTrack","cwcdtrackM_wpclsQueryTitle");

    if(chrTitle[0]==0)
      if(!getMessage(chrTitle, IDSTR_CDTRACKTITLE, sizeof(chrTitle), queryResModuleHandle(), HWND_DESKTOP))
        strcpy(chrTitle, CLSTITLE_CDTRACK);

    return chrTitle;
}

/*
 * The prototype for cwcdtrackM_wpclsQueryInstanceType was replaced by the following prototype:
 */
SOM_Scope PSZ  SOMLINK cwcdtrackM_wpclsQueryInstanceType(M_MMCDTrack *somSelf)
{
    /* M_CWCDTrackData *somThis = M_CWCDTrackGetData(somSelf); */
    M_MMCDTrackMethodDebug("M_MMCDTrack","cwcdtrackM_wpclsQueryInstanceType");

    return TYPE_CDTRACK;
}

/*
 * The prototype for cwcdtrackM_wpclsQueryDefaultHelp was replaced by the following prototype:
 */

SOM_Scope BOOL  SOMLINK cwcdtrackM_wpclsQueryDefaultHelp(M_MMCDTrack *somSelf, 
                                                         PULONG pHelpPanelId, 
                                                         PSZ pszHelpLibrary)
{
  PSZ pszHelpLibName;
    /* M_CWCDTrackData *somThis = M_CWCDTrackGetData(somSelf); */
    M_MMCDTrackMethodDebug("M_MMCDTrack","cwcdtrackM_wpclsQueryDefaultHelp");

    if((pszHelpLibName=_queryMp3HelpLibraryName())!=NULLHANDLE)
      {
        if(pHelpPanelId)
          *pHelpPanelId=CDTRACK_HELP_PANEL;
        if(pszHelpLibrary)
          strncpy(pszHelpLibrary, pszHelpLibName, CCHMAXPATH);
        return TRUE; 
      }

    return (M_MMCDTrack_parent_M_MMAudio_wpclsQueryDefaultHelp(somSelf, 
                                                               pHelpPanelId, 
                                                               pszHelpLibrary));
}




